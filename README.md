# Техническое обеспечение и администрирование геоинформационных систем в деятельности ООПТ

## 1. Развертывание и настройка ArcGIS Enterprise

Список портов, которые необходимы для работы ArcGIS Enterprise (необходимо открыть в брандмауэре):
- сервер: 6443, 6080, 6006;
- портал: 7080, 7443;
- датастор: 2443, 9876, 29080, 29081, 4369, 29079, 29085, 29090, 9220, 9320, 6443, 9829. 

[Развертывание системы ArcGIS Enterprise](https://blogs.esri-cis.com/2022/07/14/arcgis_enterprise_deployment1091/):

- [Руководство по установке ArcGIS Server 10.9.1 (Windows)](https://enterprise.arcgis.com/ru/server/10.9.1/install/windows/welcome-to-the-arcgis-for-server-install-guide.htm)
  
- [Руководство по установке Portal for ArcGIS 10.9.1 (Windows)](https://enterprise.arcgis.com/ru/portal/10.9.1/install/windows/welcome-to-the-portal-for-arcgis-installation-guide.htm)
  
- [Руководство по установке ArcGIS Data Store 10.9.1 (Windows)](https://enterprise.arcgis.com/ru/data-store/10.9.1/install/windows/welcome-to-arcgis-data-store-installation-guide.htm)
  
- [Руководство по установке ArcGIS Web Adaptor 10.9.1 (Java Platform)](https://enterprise.arcgis.com/ru/web-adaptor/10.9.1/install/java-windows/welcome-arcgis-web-adaptor-install-guide.htm)

[Подводные камни установки серверных продуктов ArcGIS](https://blogs.esri-cis.ru/2015/06/08/underwater-stones-installation-arcgis-server/)

## 2. Развертывание настройка PostgreSQL, интеграция с ArcGIS Desktop

[]()

Версии ПО в ГИС ГПУ "НП "Нарочанский":
- ArcGIS Enterprise (ArcGIS Server, Portal for ArcGIS, ArcGIS Data Store, ArcGIS Web Adaptor) все версии 10.9.1.
- PostgreSQL 10.8.
- ArcGIS Desktop 10.8 или 10.6.1.
- ArcGIS Pro 3.0.0.

Все это корректно работает между собой.

[Требования к версии PostgreSQL ПО ArcGIS оф. документация](https://enterprise.arcgis.com/ru/system-requirements/10.9.1/windows/database-requirements-postgresql.htm)

По умалчанию PostgreSQL использует порт 5432, его необходимо открыть в брандмауэре.

### Шаг 1. Установка

[Установка PostreSQL](https://metanit.com/sql/postgresql/1.1.php)

### Шаг 2. Настройка входящих подключений

[Настраиваем подключения через файл pg_hba.conf](http://postgrespro.ru/docs/postgrespro/10/auth-pg-hba-conf)

Файл по умолчанию находится в директории, которая была указана при установке PostreSQL для хранения базы данных.

[Наш рабочий файл pg_hba.conf](http://gisoopt.by/gis/data/temp/pg_hba.rar)


### Шаг 3. Добавление типа ST_Geometry в базу данных PostgreSQL

Для соединения с СУБД PostreSQL ПО ArcGIS Desktop  необходимо добавть библиотеку ST_Geometry в директорию установки PostgreSQL, для этого:
- из директории установки ArcGIS Desktop (по умолчанию c:\Program Files (x86)\ArcGIS\Desktop10.8\DatabaseSupport\PostgreSQL\) для соответсвующей версии СУБД и операционной системы скопировать файл st_geometry.dll;
- перейти в директорию установки СУБД PostreSQL (по умолчанию c:\Program Files\PostgreSQL\10\lib\) и вставить скопированую библиотеку.

Как должно выглядеть подключение к многопользовательской БД в ArcGIS Desktop / ArcGIS Pro:

![](https://github.com/a91n0d/gis_naroch/blob/main/source/connect_DB.jpg?raw=true)

где:
- 1 - Имя платформы БД;
- 2 - Адрес сервера;
- 3 - Имя пользователя и пароль;
- 4 - Выбор подключаемой БД из перечня.

## 3. Создание многопользовательской базы данных в ArcGIS Pro

### Шаг 1. Создание многопользовательской БД

Для создания базы данных зайти на вкладку *Анализ* -> *Инструменты*.

![Панель управления ArcGIS Pro](https://github.com/user-attachments/assets/7c814672-f8ed-49e6-b916-112380cb8c80)

Во вкладке *Геообработка* ввести **Создать многопользовательскую базу данных**.

![Инструменты Геообработки](https://github.com/user-attachments/assets/a36bb97c-96a2-41a5-b05c-4b1369039e15)

Последовательность действий при создание многопользовательской БД

1. в окне **Создать многопользовательскую базу** в поле *Платформа базы данных* указать PostgreSQL;
2. в поле *Экземпляр* – экземпляр БД;
3. в поле *База данных* – название базы данных;
4. в поле *Администратор базы данных* – postgres;
5. в поле *Пароль администратора базы данных* – пароль, заданный при установки PostgreSQL;
6. в поле *Пароль администратора базы данных* – повторно ввести предыдущий пароль;
7. в поле *Файл авторизации* – файл авторизации к ArcGIS Enterprise;
8. в поле *Пространственный тип* – PostGIS.

![Параметры создания многопользовательской БД](https://github.com/user-attachments/assets/dfdc6969-5208-4822-941b-804ad3fda836)

### Шаг 2. Подключение к созданной БД

После создания многопользовательской базы данных нажать правой кнопкой на Базы данных и в выпадающем списке выбрать Новое подключение к базе данных.

![Подключени к БД](https://github.com/user-attachments/assets/f1b20f09-734c-4c05-a94a-8eab0e31a27c)

Последовательность действий при подключении к БД

1. в окне *Подключение базы данных* в поле *Платформа базы данных* указать PostgreSQL;
2. в поле *Экземпляр* – экземпляр базы данных;
3. в поле *Тип авторизации* – Аутентификация в базе данных;
4. в поле *Имя пользователя* – имя пользователя к базе данных;
5. в поле *Пароль* – пароль к данной базе;
6. в поле *База данных* в выпадающем списке выбрать необходимую базу;
7. поставить галочку напротив *Сохранить Пользователя\Пароль*.

![Параметры подключения БД](https://github.com/user-attachments/assets/73eba0f4-7895-4d86-972a-34bb74de3953)

### Шаг 3. Администрирование БД

На следующем этапе необходимо произвести администрирование базы данных. Для этого нажать правой клавишей мыши на добавленную базу данных в выпадающем списке выбрать *Администрирование* –> *Создать пользователя базы данных*. 

![Окно администрирования](https://github.com/user-attachments/assets/4d471acf-17c9-471e-8fcd-3013dda0d0c2)

Последовательность действий при подключении к БД

1. в появившемся окне **Создать пользователя базы данных** в поле *Входное подключение к базе данных* указать необходимую базу данных;
2. в поле *Пользователь базы данных* ввести имя пользователя;
3. в поле *Пароль пользователя базы данных* указать пароль пользователя.

![Параметры создания пользователя БД](https://github.com/user-attachments/assets/2006d8fa-3777-4597-bb63-c52c283dd985)

### Шаг 4. Создание нового подключения к БД

После создания нового пользователя в базе данных необходимо создать новое подключение к базе данных под данным пользователем. Для этого следуем инструкции Шаг 2.

![Создание нового подключения](https://github.com/user-attachments/assets/615c8731-80c8-49bd-81f9-fec167b807bf)

![Повторное подключение к БД](https://github.com/user-attachments/assets/cc19abe8-2996-4551-bb05-1d6a4cfb33ba)

![Результат подключения БД](https://github.com/user-attachments/assets/187d6010-250f-4a2b-b7e8-abc9548d6d89)

## 4. Преднастройка слоёв в ArcGIS Pro

Для предварительной настройки слоя в базе данных необходимо нажать правой кнопкой мыши на слой и выбрать *Управление*.

![Управление слоем](https://github.com/user-attachments/assets/93fd4e44-5955-4304-95b7-fef5dd4a52a8)

Во вкладке **Управление** производим преднастройку слоя.

![img12](https://github.com/user-attachments/assets/22926377-3bd2-4162-a963-3aa64df256cb)

1. В поле *Управление версиями* рекомендуем выбирать *Традиционный*.

Подробнее с вопросом версионности можно ознакомится в официальной документации на  сайте ESRI по ссылкам представленным ниже.

(https://pro.arcgis.com/ru/pro-app/latest/help/data/geodatabases/overview/change-settings-for-editing-versioned-data.htm)
(https://pro.arcgis.com/ru/pro-app/latest/help/data/geodatabases/overview/versioning-tab.htm)

2. Поле *Архивирование* предоставляет механизм сбора сведений об изменении данных, управления ими и их анализа.

Подробнее с вопросом архивирования можно ознакомится в официальной документации на сайте ESRI по ссылкам представленным ниже.

(https://pro.arcgis.com/ru/pro-app/latest/help/data/geodatabases/overview/what-is-archiving-.htm)

3. Поле *Отслеживание реплики* включает отслеживание реплики для данных, позволяя работать с автономными картами и в распределенном сотрудничестве. Отслеживание реплики применяется к сервисам, настроенным с возможностью синхронизации с опцией создания версии для каждой загруженной карты.

Подробнее с вопросом отслеживания реплик можно ознакомится в официальной документации на сайте ESRI по ссылкам представленным ниже.

(https://pro.arcgis.com/ru/pro-app/latest/tool-reference/data-management/enable-replica-tracking.htm)

4. Поле *Вложения* предоставляет доступ к добавлению файловых вложений к записям класса пространственных объектов или таблицы базы геоданных. Вложения хранятся в базе геоданных в отдельной таблице вложений, которая связана с целевым набором данным. Вложения добавляются к целевому набору данных с помощью таблицы соответствия, которая указывает для каждой входной записи (или группы атрибутов записей) путь к файлу для добавления в качестве вложения к этой записи.
   
Подробнее с вопросом вложений можно ознакомится в официальной документации на сайте ESRI по ссылке представленной ниже.  

(https://pro.arcgis.com/ru/pro-app/latest/tool-reference/data-management/add-attachments.htm)

5. В поле *Глобальные идентификаторы* рекомендуем всегда ставить галочку. Данное поле добавляет идентификаторы в перечень классов пространственных объектов базы геоданных, таблиц и наборов классов объектов.

Подробнее с вопросом глобальных идентификаторов можно ознакомится в официальной документации на сайте ESRI по ссылке представленной ниже.  

(https://pro.arcgis.com/ru/pro-app/latest/tool-reference/data-management/add-global-ids.htm)

6. Поле *Отслеживание изменений* предоставляет доступ для отслеживания изменений в слое во время редактирования и формирует записи о данных изменениях.

Подробнее с вопросомотслеживания изменений можно ознакомится в официальной документации на сайте ESRI по ссылке представленной ниже.  

(https://pro.arcgis.com/ru/pro-app/latest/tool-reference/data-management/disable-editor-tracking.htm)

## 5. Публикация данных из ArcGIS Pro на портал ArcGIS Enterprise

### Шаг 1. Подключение к порталу в ArcGIS Pro

В правом верхнем углу проекта ArcGIS Pro необходимо произвести вход на портал ArcGIS Enterprise.

![img13](https://github.com/user-attachments/assets/06dc23c0-a892-4d5b-81b7-2ab28ccafdbd)

В появившемся окне нажать на *Добавить портал* либо выбрать уже имеющийся портал и войти в него.

![img14](https://github.com/user-attachments/assets/50cf67d0-d53b-4396-84dc-a657a80b57f1)

В всплывающем окне *Добавить портал* ввести URL ссылку вашего портала и нажать *ОК*.

![img15](https://github.com/user-attachments/assets/f01fdb07-c5df-41c5-bbad-2d026bd9b1db)

Во вкладке **Порталы** справа от URL ссыллки портала нажать на ... и выбрать *Войти*.

![img16](https://github.com/user-attachments/assets/7678683f-0de6-4661-b009-af4e007ddd76)

В сплывающем окне указать учётные данные к порталу ArcGIS Enterprise и нажать *Вход*.

![img17](https://github.com/user-attachments/assets/7f2824a9-139a-4916-9f55-9de767dc9171)

Если у вас несколько активных порталов, то для переключения на нужный необходимо нажать на ... справа от портала и выбрать *Задать как Активный портал*.

![img18](https://github.com/user-attachments/assets/843daf80-d7e1-4015-b0ec-3bfadf30eb93)




